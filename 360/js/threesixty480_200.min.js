$(document).ready(function () {
    var aC = false,
        aG = 0,
        au = 0,
        an = "off",
        T = 0,
        Y = true,
        V = 0,
        ay = 15 * 60000,
        W = false,
        aA = 0,
        ab = 0,
        ak = 0,
        am = 0,
        ag = 10,
        aa = 0,
        aH = 3,
        aq, aI = 200,
        ai = 0,
        aj = [],
        af = 0,
        basespeed = 40,
        autospeed = 100,
        detail = false,
        astart = 1,
        aend = 0,
        speed = basespeed,
        aE = 0;
 
    function U() {
        aq = new CanvasLoader("spinner");
        aq.setShape("spiral");
        aq.setDiameter(90);
        aq.setDensity(90);
        aq.setRange(1);
        aq.setSpeed(4);
        aq.setColor("#FFFFFF");
        aq.show();
        $("#spinner").fadeIn("slow");
    }

    function al() {
        var c = document.createElement("li");
        var b = "area51/480_200_1920/b_" + (aE + 1) + ".jpg";
        var a = $("<img>").attr("src", b).addClass("previous-image").appendTo(c);
        aj.push(a);
        $("#threesixty_images").append(c);
        $(a).load(function () {
            az()
        })
    }
    function az() {
        aE++;
        $("#spinner span").text(Math.floor(aE / aI * 100) + "%");
        if (aE == aI) {
            aj[0].removeClass("previous-image").addClass("current-image");
            $("#spinner").fadeOut("slow", function () {
                $("#breathelight").fadeIn("slow", function () {
                    aq.hide();
                    // $("#breathelight").append('<li class="bluelight"><img src="area51/breathelight.png"/></li>');
                    ac("standby")
                    ax()
                })
            })
        } else {
            al()
        }
    }
    function ae() {
        window.clearTimeout(V);
        W = false;
        Y = true;
        af = aF();
        R();
        $("#threesixty_progress").fadeOut();
        $(".progressbar").fadeOut()
        $("#return").hide();
    }
    function ax() {
        $("#threesixty_images").fadeIn("slow");
        aC = true;
        Y = false;
        af = 201;
        ad("standby");
        ac("audio");
        R();
        // V = setTimeout(ae, ay);
    }
    ar(document.documentElement);
    U();
    al();

    function ap() {
        if (ai !== af) {
            window.clearTimeout(aG);
            window.clearTimeout(V);
            aG = 0;
            T = 0;
            if(detail == true){ao();}
            var b = af < ai ? Math.floor((af - ai) * 0.1) : Math.ceil((af - ai) * 0.1);
            av();
            ai += b;
            Z()
        } else {
            window.clearInterval(aa);
            V = setTimeout(ae, ay);
            aa = 0;
            var a = ah();
            // console.log(a);
            ad("story");
            if (Y) {
                aC = false
            }
            if (aC == false) {
                window.clearTimeout(V);
                V = 0;
                $("#threesixty_images").fadeOut("slow", function () {
                    $("#breathelight").fadeIn("slow", function () {
                        $("#breathelight").append('<li class="bluelight"><img src="area51/breathelight.png"/></li>');
                        ac("standby");
                    })
                });
                $("#threesixty_progress").removeAttr("style")
            } else {
                $("#threesixty_progress").animate({
                    bottom: "2%",
                    opacity: 1
                }, 1500);
                $("#return").fadeIn();
                ac("bgm")
            } 
            if (1 < a && a < 8 && a != 2) {
                au = aB(2);
                if (aG === 0) {
                    aG = self.setInterval(S, autospeed)
                }
            } else {
                if (1 < a && a < 4) {
                    T = setTimeout(aD("cover"), 1000)
                } else {
                    if (9 < a && a < 20 && a != 14) {
                        au = aB(14);
                        if (aG === 0) {
                            aG = self.setInterval(S, autospeed)
                        }
                    } else {
                        if (11 < a && a < 18) {
                            T = setTimeout(aD("front"), 1000)
                        } else {
                            if (30 < a && a < 42 && a != 36) {
                                au = aB(36);
                                if (aG === 0) {
                                    aG = self.setInterval(S, autospeed)
                                }
                            } else {
                                if (33 < a && a < 39) {
                                    T = setTimeout(aD("io"), 1000)
                                } else {
                                    if (67 < a && a < 79 && a != 73) {
                                        au = aB(73);
                                        if (aG === 0) {
                                            aG = self.setInterval(S, autospeed)
                                        }
                                    } else {
                                        if (70 < a && a < 76) {
                                            T = setTimeout(aD("cpu"), 1000)
                                        } else {
                                            if (120 < a && a < 132 && a != 126) {
                                                au = aB(126);
                                                if (aG === 0) {
                                                    aG = self.setInterval(S, autospeed)
                                                }
                                            } else {
                                                if (123 < a && a < 129) {
                                                    T = setTimeout(aD("gpu"), 1000)
                                                } else {
                                                    if (161 < a && a < 173 && a != 167) {
                                                        au = aB(167);
                                                        if (aG === 0) {
                                                            aG = self.setInterval(S, autospeed)
                                                        }
                                                    } else {
                                                        if (163 < a && a < 170) {
                                                            T = setTimeout(aD("power"), 1000)
                                                        } else {
                                                            if (174 < a && a < 184 && a != 178) {
                                                                au = aB(178);
                                                                if (aG === 0) {
                                                                    aG = self.setInterval(S, autospeed)
                                                                }
                                                            } else {
                                                                if (175 < a && a < 181) {
                                                                    T = setTimeout(aD("disk"), 1000)
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    function S() {
        af = au;
        if (ai !== af) {
            window.clearInterval(aa);
            window.clearTimeout(V);
            aa = 0;
            aC = false;
            T = 0;
            if(detail == true){ao();}
            var b = af < ai ? Math.floor((af - ai) * 0.1) : Math.ceil((af - ai) * 0.1);
            av();
            ai += b;
            Z()
        } else {
            window.clearTimeout(aG);
            V = setTimeout(ae, ay);
            aG = 0;
            aC = true;
            ad("story");
            var a = ah();
            if (aC == false) {
                window.clearTimeout(V);
                $("#threesixty_images").fadeOut("slow", function () {
                    $("#breathelight").fadeIn("slow", function () {
                        $("#breathelight").append('<li class="bluelight"><img src="area51/breathelight.png"/></li>');
                        ac("standby")
                    })
                });
                $("#threesixty_progress").removeAttr("style")
            }
            if (1 < a && a < 4) {
                T = setTimeout(aD("cover"), 1000)
            } else {
                if (11 < a && a < 18) {
                    T = setTimeout(aD("front"), 1000)
                } else {
                    if (33 < a && a < 39) {
                        T = setTimeout(aD("io"), 1000)
                    } else {
                        if (70 < a && a < 76) {
                            T = setTimeout(aD("cpu"), 1000)
                        } else {
                            if (123 < a && a < 129) {
                                T = setTimeout(aD("gpu"), 1000)
                            } else {
                                if (163 < a && a < 170) {
                                    T = setTimeout(aD("power"), 1000)
                                } else {
                                    if (175 < a && a < 181) {
                                        T = setTimeout(aD("disk"), 1000)
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    function R() {
        if (aa === 0 && aC == true) {
            aa = self.setInterval(ap, speed)
        }
    }
    function av() {
        aj[at()].removeClass("current-image").addClass("previous-image")
    }
    function Z() {
        aj[at()].removeClass("previous-image").addClass("current-image");
        $("#threesixty_progress li").width((100 - at() / 2) + "%")
    }
    function at() {
        var a = -Math.ceil(ai % aI);
        if (a < 0) {
            a += (aI - 1)
        }
        return a
    }
    function X(a) {
        return a.originalEvent.targetTouches ? a.originalEvent.targetTouches[0] : a
    }
    $("#threesixty").mousedown(function (a) {
        a.preventDefault();
        aA = X(a).pageX;
        astart = ah();
        W = true
    });
    $(document).mouseup(function (a) {
        a.preventDefault();
        W = false;
        window.clearTimeout(V);
        V = setTimeout(ae, ay)
    });
    $(document).mousemove(function (a) {
        a.preventDefault();
        speed = basespeed;
        aw(a);
        window.clearTimeout(V);
        V = setTimeout(ae, ay)
    });
    $(document).live("touchend", function (a) {
        window.clearTimeout(V);
        V = setTimeout(ae, ay)
    });
    $("#threesixty").live("touchstart", function (a) {
        a.preventDefault();
        aA = X(a).pageX;
        astart = ah();
        W = true
    });
    $("#threesixty").live("touchmove", function (a) {
        a.preventDefault();
        speed = basespeed;
        aw(a);
        window.clearTimeout(V);
        V = setTimeout(ae, ay)
    });
    $("#threesixty").live("touchend", function (a) {
        a.preventDefault();
        W = false;
        window.clearTimeout(V);
        V = setTimeout(ae, ay)
    });
    $("#story_cpu").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(73);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_cpu").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(73);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_cover").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(2);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_cover").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(2);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_front").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(14);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_front").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(14);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_io").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(36);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_io").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(36);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_gpu").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(126);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_gpu").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(126);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_power").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(167);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_power").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(167);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_disk").mouseup(function (a) {
        if (an == "on") {
            return
        }
        ao();
        a.preventDefault();
        W = false;
        af = aB(178);
        speed = autospeed;
        R();
        ac("story")
    });
    $("#story_disk").live("touchend", function () {
        if (an == "on") {
            return
        }
        ao();
        event.preventDefault();
        W = false;
        af = aB(178);
        speed = autospeed;
        R();
        ac("story")
    });

    $("#finger_touch").on("touchend mouseup",function(){
        $("#breathelight").hide();
        $("#threesixty_images").show(function(){
            ax();
        });
    })
    // $("#finger_touch").mousedown(function (a) {
    //     $("#finger img").attr("src", "img/finger_2.png")
    // });
    // $("#finger_touch").live("touchstart", function () {
    //     $("#finger img").attr("src", "img/finger_2.png")
    // });
    // $("#finger_touch").mouseup(function (a) {
    //     $("#finger img").attr("src", "img/finger_1.png");
    //     $("#breathelight").hide();
    //     $("#breathelight .bluelight").remove();
    //     $("#threesixty_images").show(function(){
    //         ax();
    //     });
    // });
    // $("#finger_touch").live("touchend", function () {
    //     $("#finger img").attr("src", "img/finger_1.png");
    //     $("#breathelight").hide();
    //     $("#breathelight .bluelight").remove();
    //     $("#threesixty_images").show(function(){
    //         ax();
    //     });
    // });

    // $("#finger_touch_desk").mousedown(function (a) {
    //     $("#finger_desk img").attr("src", "img/finger_desk_touch.png");
    // });
    // $("#finger_touch_desk").live("touchstart", function () {
    //     $("#finger_desk img").attr("src", "img/finger_desk_touch.png");
    // });
    // $("#finger_touch_desk").mouseup(function (a) {
    //     $("#solutions").fadeIn();
    //     $("#finger_desk img").attr("src", "img/finger_desk.png");
    // });
    // $("#finger_touch_desk").live("touchend", function () {
    //     $("#solutions").fadeIn();
    //     $("#finger_desk img").attr("src", "img/finger_desk.png");
    // });

    // $("#solutions").mouseup(function (a) {
    //     $(this).fadeOut();
    // });
    // $("#solutions").live("touchend", function () {
    //     $(this).fadeOut();
    // });

    $("#return").on("mouseup touchend",function (a) {
        ae();
        ad("bgm")
        ac("standby")
    });

    function ac(b) {
        return;
        var a = document.getElementById(b);
        a.play()
    }
    function ad(b) {
        return;
        var a = document.getElementById(b);
        a.pause();
        a.load()
    }
    function aD(a) {
        if ($("#story_" + a).hasClass("bounce") == true) {
            return
        }
        if (an == "off") {
        	detail = true;
            $("#treesixty_detail>li>div").stop(true).hide();
            $("#threesixty_progress").find("." + a).addClass("bounce");
            $("#detail_" + a).find(".light").fadeIn("slow");
            $("#detail_" + a).find(".mark").show().animate({
                left: "0%",
                opacity: 1
            }, 500, function () {
                $("#detail_" + a).find(".title").show().animate({
                    top: "0%",
                    opacity: 1
                }, 300);
                $("#detail_" + a).find(".content").show().animate({
                    top: "0%",
                    opacity: 1
                }, 300)
            })
        }
    }
    function ao() {
        an = "on";
        $("#threesixty_progress span").removeClass("bounce");
        $("#treesixty_detail li div").hide(function () {
            $(this).removeAttr("style");
            an = "off";
            detail = false;
        })
    }
    function aB(a) {
    	aend = a;
        var b = ah();
        if (b > a) {
            var c = ai - (b - a)
        } else {
            var c = ai + (a - b)
        }
        return c
    }
    function aF() {
        var a = ah();
        var b = ai - a - aI + 1;
        return b
    }
    function ah() {
        return Math.abs(Math.ceil(ai % aI))
    }
    function aw(a) {
        if (aC && W) {
            ab = X(a).pageX;
            if (am < new Date().getTime() - ag) {
                ak = ab - aA;
                af = ai + Math.ceil((aI - 1) * aH * (ak / $("#threesixty").width()));
                R();
                am = new Date().getTime();
                aA = X(a).pageX
            }
        }
    }
    function ar(a) {
        if (a.requestFullscreen) {
            a.requestFullscreen()
        } else {
            if (a.mozRequestFullScreen) {
                a.mozRequestFullScreen()
            } else {
                if (a.webkitRequestFullscreen) {
                    a.webkitRequestFullscreen()
                } else {
                    if (a.msRequestFullscreen) {
                        a.msRequestFullscreen()
                    }
                }
            }
        }
    }
});